<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Puppet Litmus Test Tool | .</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Puppet Litmus Test Tool" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="." />
<meta property="og:description" content="." />
<link rel="canonical" href="https://puppetlabs.github.io/litmus/Running-acceptance-tests.html" />
<meta property="og:url" content="https://puppetlabs.github.io/litmus/Running-acceptance-tests.html" />
<meta property="og:site_name" content="Puppet Litmus Test Tool" />
<script type="application/ld+json">
{"headline":"Puppet Litmus Test Tool","description":".","@type":"WebPage","url":"https://puppetlabs.github.io/litmus/Running-acceptance-tests.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/litmus/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://puppetlabs.github.io/litmus/feed.xml" title="Puppet Litmus Test Tool" />
    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-157301458-1', 'auto');
	ga('send', 'pageview', { 'page': location.pathname + location.search + location.hash});
	ga('set', 'anonymizeIp', true);
    </script>
    <!-- End Google Analytics -->
    </head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/litmus/">Puppet Litmus Test Tool</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/litmus/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title"></h1>
  </header>

  <div class="post-content">
    <p>The following example walks you through running an acceptance test on the <a href="https://github.com/puppetlabs/puppetlabs-motd">MoTD</a> module.</p>

<p>The process involves these steps:</p>

<ol>
  <li>Clone the MoTD module from GitHub.</li>
  <li>Provision a CentOS Docker image.</li>
  <li>Install a Puppet 6 agent on the CentOS image.</li>
  <li>Install the MoTD module on the CentOS image.</li>
  <li>Run the MoTD acceptance tests.</li>
  <li>Remove the Docker image.</li>
</ol>

<h2 id="before-you-begin">Before you begin</h2>

<p>Ensure you have installed the following:</p>

<ul>
  <li><a href="https://runnable.com/docker/getting-started/">Docker</a>.
    <ul>
      <li>To check whether you already have Docker, run <code class="language-plaintext highlighter-rouge">docker --version</code> from the command line.</li>
      <li>To check Docker is working, run <code class="language-plaintext highlighter-rouge">docker run centos:7 ls</code> in your terminal. You should see a list of folders in the CentOS image.</li>
    </ul>
  </li>
  <li><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">Git</a>
    <ul>
      <li>To check  where you already have git, run <code class="language-plaintext highlighter-rouge">git --version</code> in your terminal.</li>
    </ul>
  </li>
  <li><a href="https://puppet.com/docs/pdk/1.x/pdk_install.html">Puppet Development Kit (PDK)</a>.
    <ul>
      <li>To check whether you already have PDK, run <code class="language-plaintext highlighter-rouge">pdk --version</code> from the command line. Note that you need version <code class="language-plaintext highlighter-rouge">1.17.0</code> or later. If not, then following the <a href="https://puppet.com/docs/pdk/1.x/pdk_install.html">installation instructions</a>.</li>
    </ul>
  </li>
</ul>

<h2 id="1-clone-the-motd-module-from-github">1. Clone the MoTD module from GitHub.</h2>

<p>From  the command line, clone the Litmus branch of MoTD module:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/puppetlabs/puppetlabs-motd.git
</code></pre></div></div>
<p>You now have a local copy of the module on your machine. In this example, you can work  off the master branch.</p>

<p>Change directory to the MoTD module</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd puppetlabs-motd
</code></pre></div></div>

<h2 id="2-install-the-necessary-gems">2. Install the necessary gems.</h2>

<p>The MoTD module relies on a number of gems. To install these on your machine, run the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdk bundle install
</code></pre></div></div>

<h2 id="3-provision-a-centos-docker-image">3. Provision a CentOS Docker image.</h2>

<p>Provision a CentOS 7 image in a Docker container to be the target you will test against</p>

<p>To provision the CentOS 7 target (or any OS of your choice), run the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdk bundle exec rake 'litmus:provision[docker, litmusimage/centos:7]'
</code></pre></div></div>

<blockquote>
  <p>Note: Provisioning is extensible. If your preferred provisioner is missing, let us know by raising an issue on the <a href="https://github.com/puppetlabs/provision/issues">provision repo</a> or submitting a <a href="https://github.com/puppetlabs/provision/pulls">PR</a>.</p>
</blockquote>

<p>The last lines of the output should look like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Provisioning centos:7 using docker provisioner.[âœ”]
localhost:2222, centos:7
</code></pre></div></div>

<p>To check that it worked, run <code class="language-plaintext highlighter-rouge">docker ps</code> and you should see output similar to:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                  NAMES
7b12b616cf65        centos:7            "/bin/bash"         4 minutes ago       Up 4 minutes        0.0.0.0:2222-&gt;22/tcp   centos_7-2222
</code></pre></div></div>

<p>Note that the provisioned targets will be in the <code class="language-plaintext highlighter-rouge">spec/fixtures/litmus_inventory.yaml</code> file. Litmus creates this file in your working directory. If you run <code class="language-plaintext highlighter-rouge">cat spec/fixtures/litmus_inventory.yaml</code>, you should see the targets you just created. For example:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># litmus_inventory.yaml</span>
<span class="nn">---</span>
<span class="na">version</span><span class="pi">:</span> <span class="m">2</span>
<span class="na">groups</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">docker_nodes</span>
  <span class="na">targets</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ssh_nodes</span>
  <span class="na">targets</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">uri</span><span class="pi">:</span> <span class="s">localhost:2222</span>
    <span class="na">config</span><span class="pi">:</span>
      <span class="na">transport</span><span class="pi">:</span> <span class="s">ssh</span>
      <span class="na">ssh</span><span class="pi">:</span>
        <span class="na">user</span><span class="pi">:</span> <span class="s">root</span>
        <span class="na">password</span><span class="pi">:</span> <span class="s">root</span>
        <span class="na">port</span><span class="pi">:</span> <span class="m">2222</span>
        <span class="na">host-key-check</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">facts</span><span class="pi">:</span>
      <span class="na">provisioner</span><span class="pi">:</span> <span class="s">docker</span>
      <span class="na">container_name</span><span class="pi">:</span> <span class="s">centos_7-2222</span>
      <span class="na">platform</span><span class="pi">:</span> <span class="s">centos:7</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">winrm_nodes</span>
  <span class="na">targets</span><span class="pi">:</span> <span class="pi">[]</span>
</code></pre></div></div>

<h2 id="4-install-puppet-agent-on-your-target">4. Install Puppet agent on your target</h2>

<p>To install the latest version of Puppet agent on the CentOS Docker image, run the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdk bundle exec rake litmus:install_agent
</code></pre></div></div>

<p>Use Bolt to verify that you have installed the agent on the target. Run the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdk bundle exec bolt command run 'puppet --version' --targets localhost:2222 --inventoryfile spec/fixtures/litmus_inventory.yaml
</code></pre></div></div>

<p>Note that <code class="language-plaintext highlighter-rouge">localhost:2222</code> is the name of the node in the spec/fixtures/litmus_inventory.yaml file. You should see output with the version of the Puppet agent that was installed:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bolt command run 'puppet --version' --targets localhost:2222 --inventoryfile spec/fixtures/litmus_inventory.yaml
</code></pre></div></div>

<p>Running the command will produce output similar to this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Started on localhost:2222...
Finished on localhost:2222:
  STDOUT:
    6.13.0
Successful on 1 target: localhost:2222
Ran on 1 target in 1.72 sec
</code></pre></div></div>

<p>If you want to install a specific version of puppet you can use the following command:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdk bundle exec rake 'litmus:install_agent[puppet6]
</code></pre></div></div>
<p>Examples of other versions you can pass in are: puppet6-nightly, puppet7, puppet7-nightly.</p>

<h2 id="5-install-the-motd-module-on-the-centos-image">5. Install the MoTD module on the CentOS image.</h2>

<p>To install the MoTD module on the CentOS image, run the following command from inside your working directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdk bundle exec rake litmus:install_module
</code></pre></div></div>

<p><em>Note: If you are interactively modifying code and testing, this step must be run after your changes are made and before you run your tests.</em></p>

<p>You will see output similar to:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>âžœ  puppetlabs-motd git:(main) pdk bundle exec rake litmus:install_module
pdk (INFO): Using Ruby 2.6.3
pdk (INFO): Using Puppet 7.7.0
Building '/Users/paula/workspace/puppetlabs-mysql' into '/Users/paula/workspace/puppetlabs-motd/pkg'
Built '/Users/paula/workspace/puppetlabs-motd/pkg/puppetlabs-motd-11.0.3.tar.gz'
Installed '/Users/paula/workspace/puppetlabs-motd/pkg/puppetlabs-motd-11.0.3.tar.gz' on
</code></pre></div></div>

<p>Use Bolt to verify that you have installed the MoTD module. Run the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdk bundle exec bolt command run 'puppet module list' --targets localhost:2222 -i spec/fixtures/litmus_inventory.yaml
</code></pre></div></div>

<p>The output should look similar to:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Started on localhost...
Finished on localhost:
  STDOUT:
    /etc/puppetlabs/code/environments/production/modules
    â”œâ”€â”€ puppetlabs-motd (v2.1.2)
    â”œâ”€â”€ puppetlabs-registry (v2.1.0)
    â”œâ”€â”€ puppetlabs-stdlib (v5.2.0)
    â””â”€â”€ puppetlabs-translate (v1.2.0)
    /etc/puppetlabs/code/modules (no modules installed)
    /opt/puppetlabs/puppet/modules (no modules installed)
Successful on 1 node: localhost:2222
Ran on 1 node in 1.11 seconds
Started on localhost:2222...
Finished on localhost:2222:
  STDOUT:
    /etc/puppetlabs/code/environments/production/modules
    â”œâ”€â”€ puppetlabs-motd (v4.1.0)
    â”œâ”€â”€ puppetlabs-registry (v3.1.0)
    â”œâ”€â”€ puppetlabs-stdlib (v6.2.0)
    â””â”€â”€ puppetlabs-translate (v2.1.0)
    /etc/puppetlabs/code/modules (no modules installed)
    /opt/puppetlabs/puppet/modules (no modules installed)
Successful on 1 target: localhost:2222
Ran on 1 target in 1.77 sec
</code></pre></div></div>

<p>Note that you have also installed the MoTD moduleâ€™s dependent modules.</p>

<h2 id="6-run-the-motd-acceptance-tests">6. Run the MoTD acceptance tests</h2>

<p>To run acceptance tests with Litmus, run the following command from your working directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdk bundle exec rake litmus:acceptance:parallel
</code></pre></div></div>

<p>This command executes the acceptance tests in the <a href="https://github.com/puppetlabs/puppetlabs-motd/tree/main/spec/acceptance">acceptance folder</a> of the module. If the tests have run successfully, you will see output similar to (Note it will look like it has stalled but is actually running tests in the background, please be patient and the output will appear when the tests are complete:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+ [âœ”] Running against 1 targets.
|__ [âœ”] localhost:2222, centos:7
================
localhost:2222, centos:7
......

Finished in 42.95 seconds (files took 10.15 seconds to load)
6 examples, 0 failures

pid 1476 exit 0
Successful on 1 nodes: ["localhost:2222, centos:7"]
</code></pre></div></div>

<h2 id="7-remove-the-docker-image">7. Remove the Docker image.</h2>

<p>Now that you have completed your tests, you can remove the Docker image with the Litmus tear down command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdk bundle exec rake litmus:tear_down
</code></pre></div></div>

<p>You should see JSON output, similar to:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>localhost:2222: success
</code></pre></div></div>

<p>To verify that the target has been removed, run <code class="language-plaintext highlighter-rouge">docker ps</code> from the command line. You should see that itâ€™s no longer running.</p>

<h2 id="next-steps">Next steps</h2>

<p>The MoTD shows you how to use Litmus to acceptance test an existing module. As you scale up your acceptance testing, you will need to write your own acceptance tests. Try out the following:</p>

<ul>
  <li>Provision more than one system, for example, <code class="language-plaintext highlighter-rouge">pdk bundle exec rake 'litmus:provision[docker, centos:6]'</code>. Note that you will need to re-run the <code class="language-plaintext highlighter-rouge">install_agent</code> and <code class="language-plaintext highlighter-rouge">install_module</code> command if you want to run tests.</li>
  <li>Look at the inventory file and take note of the ssh connection information</li>
  <li>ssh into the CentOS box when you know the password, for example, <code class="language-plaintext highlighter-rouge">ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no root@localhost -p 2222</code>, or use Bolt as shown in the example.</li>
  <li>ssh into the CentOS box without a password, run <code class="language-plaintext highlighter-rouge">docker ps</code>, take note of the Container Name and then run <code class="language-plaintext highlighter-rouge">docker exec -it litmusimage_centos_7-2222 '/bin/bash'</code> in this example litmusimage_centos_7-2222 is the Container Name.</li>
</ul>

<blockquote>
  <p>Note: We have moved all our PR testing to public pipelines to make contributing to Puppet supported modules a better experience. Check out our <a href="https://github.com/puppetlabs/puppetlabs-apache/pull/2141">PR testing matrix</a> Github Actions. All of our testing is now ran in the one place.</p>
</blockquote>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/litmus/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Puppet Litmus Test Tool</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Puppet Litmus Test Tool</li><li><a class="u-email" href="mailto:ia_content@puppet.com">ia_content@puppet.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/puppetlabs"><svg class="svg-icon"><use xlink:href="/litmus/assets/minima-social-icons.svg#github"></use></svg> <span class="username">puppetlabs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
