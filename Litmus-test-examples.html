<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Puppet Litmus Test Tool | .</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Puppet Litmus Test Tool" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="." />
<meta property="og:description" content="." />
<link rel="canonical" href="https://puppetlabs.github.io/litmus/Litmus-test-examples.html" />
<meta property="og:url" content="https://puppetlabs.github.io/litmus/Litmus-test-examples.html" />
<meta property="og:site_name" content="Puppet Litmus Test Tool" />
<script type="application/ld+json">
{"headline":"Puppet Litmus Test Tool","description":".","@type":"WebPage","url":"https://puppetlabs.github.io/litmus/Litmus-test-examples.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/litmus/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://puppetlabs.github.io/litmus/feed.xml" title="Puppet Litmus Test Tool" />
    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-157301458-1', 'auto');
	ga('send', 'pageview', { 'page': location.pathname + location.search + location.hash});
	ga('set', 'anonymizeIp', true);
    </script>
    <!-- End Google Analytics -->
    </head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/litmus/">Puppet Litmus Test Tool</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/litmus/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title"></h1>
  </header>

  <div class="post-content">
    <p>These are some common examples you can use in your tests. Take note of the differences between beaker-rspec style testing and Litmus.</p>

<h2 id="testing-puppet-code">Testing Puppet code</h2>

<p>The following example tests that your Puppet code works. Take note of the repeatable pattern.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'spec_helper_acceptance'</span>

<span class="n">describe</span> <span class="s1">'a feature'</span><span class="p">,</span> <span class="ss">if: </span><span class="p">[</span><span class="s1">'debian'</span><span class="p">,</span> <span class="s1">'redhat'</span><span class="p">,</span> <span class="s1">'ubuntu'</span><span class="p">].</span><span class="nf">include?</span><span class="p">(</span><span class="n">os</span><span class="p">[</span><span class="ss">:family</span><span class="p">])</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:pp</span><span class="p">)</span> <span class="k">do</span>
    <span class="o">&lt;&lt;-</span><span class="no">MANIFEST</span><span class="sh">
      include feature::some_class
</span><span class="no">    MANIFEST</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'applies idempotently'</span> <span class="k">do</span>
    <span class="n">idempotent_apply</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="n">file</span><span class="p">(</span><span class="s2">"/etc/feature.conf"</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">be_file</span> <span class="p">}</span>
    <span class="n">its</span><span class="p">(</span><span class="ss">:content</span><span class="p">)</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">match</span> <span class="sr">%r{key = default value}</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="n">port</span><span class="p">(</span><span class="mi">777</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">be_listening</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="testing-manifest-code-for-idempotency">Testing manifest code for idempotency</h2>

<p>The <code class="language-plaintext highlighter-rouge">idempotent_apply</code> helper function runs the given manifest twice and will test that the first run doesn’t have errors and the second run doesn’t have changes. For many regular modules that already will give good confidence that it is working:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pp</span> <span class="o">=</span> <span class="s1">'class { "mysql::server": }'</span>
<span class="n">idempotent_apply</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="running-shell-commands">Running shell commands</h2>

<p>To run a shell command and test it’s output:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">expect</span><span class="p">(</span><span class="n">run_shell</span><span class="p">(</span><span class="s1">'/usr/local/sbin/mysqlbackup.sh'</span><span class="p">).</span><span class="nf">stderr</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="serverspec-idioms">Serverspec Idioms</h3>

<p>An example of a serverspec declaration:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">describe</span> <span class="n">command</span><span class="p">(</span><span class="s1">'/usr/local/sbin/mysqlbackup.sh'</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">its</span><span class="p">(</span><span class="ss">:stderr</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="s1">''</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="checking-facts">Checking facts</h2>

<p>With Litmus, you can use the serverspec functions — these are cached so are quick to call. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">os</span><span class="p">[</span><span class="ss">:family</span><span class="p">]</span>
</code></pre></div></div>

<p>or</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">host_inventory</span><span class="p">[</span><span class="s1">'facter'</span><span class="p">][</span><span class="s1">'os'</span><span class="p">][</span><span class="s1">'release'</span><span class="p">]</span>
</code></pre></div></div>

<p>For more information, see the <a href="https://serverspec.org/host_inventory.html">serverspec docs</a>.</p>

<h2 id="debugging-tests">Debugging tests</h2>

<p>There is a known issue when running certain commands from within a pry session. To debug tests, use the following pry-byebug gem:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span>  <span class="s1">'pry-byebug'</span><span class="p">,</span> <span class="s1">'&gt; 3.4.3'</span>
</code></pre></div></div>

<h2 id="setting-up-travis-and-appveyor">Setting up Travis and Appveyor</h2>

<p>To see this running on CI, enable the <code class="language-plaintext highlighter-rouge">use_litmus</code> flags for Travis CI and/or Appveyor. See the <a href="https://github.com/puppetlabs/pdk-templates#travisyml">pdk-templates docs</a> for details and additional options.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/litmus/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Puppet Litmus Test Tool</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Puppet Litmus Test Tool</li><li><a class="u-email" href="mailto:ia_content@puppet.com">ia_content@puppet.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/puppetlabs"><svg class="svg-icon"><use xlink:href="/litmus/assets/minima-social-icons.svg#github"></use></svg> <span class="username">puppetlabs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
